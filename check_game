-- =============================================
-- SCRIPT GAME STRUCTURE LOGGER - VERSI LENGKAP
-- Mendeteksi Auto Sell, Anti AFK, Kill Aura
-- =============================================

local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local players = game:GetService("Players")
local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")

-- Fungsi untuk membuat log dengan format rapi
local function logSection(title)
    print("=================================")
    print("ðŸ“‹ " .. title)
    print("=================================")
end

local function logInfo(label, value)
    print("  â€¢ " .. label .. ": " .. tostring(value))
end

local function logSuccess(label, value)
    print("  âœ… " .. label .. ": " .. tostring(value))
end

local function logWarning(label, value)
    print("  âš ï¸ " .. label .. ": " .. tostring(value))
end

-- =============================================
-- 1. DETEKSI AUTO SELL
-- =============================================
local function detectAutoSellInfo()
    logSection("AUTO SELL DETECTION")
    
    local sellInfo = {
        merchants = {},
        sellRemotes = {},
        itemValues = {},
        shopFolders = {},
        currencyType = "Gold",
        sellMethod = "unknown"
    }
    
    -- Cari NPC Merchant/Pedagang
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Model") then
            local name = obj.Name:lower()
            if name:find("merchant") or name:find("pedagang") or name:find("shop") or 
               name:find("trader") or name:find("seller") or name:find("vendor") or
               name:find("penjual") or name:find("toko") then
                table.insert(sellInfo.merchants, {
                    name = obj.Name,
                    position = obj:FindFirstChild("HumanoidRootPart") and obj.HumanoidRootPart.Position or "unknown"
                })
            end
        end
    end
    
    if #sellInfo.merchants > 0 then
        logSuccess("Merchant Ditemukan", #sellInfo.merchants)
        for i, merchant in ipairs(sellInfo.merchants) do
            print("    " .. i .. ". " .. merchant.name)
        end
    else
        logWarning("Merchant", "Tidak ditemukan")
    end
    
    -- Cari remote untuk jual beli
    for _, obj in ipairs(replicatedStorage:GetChildren()) do
        if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
            local name = obj.Name:lower()
            if name:find("sell") or name:find("jual") or name:find("trade") or 
               name:find("buy") or name:find("beli") or name:find("shop") or
               name:find("market") or name:find("dagang") then
                table.insert(sellInfo.sellRemotes, obj.Name)
            end
        end
    end
    
    if #sellInfo.sellRemotes > 0 then
        logSuccess("Sell Remotes", #sellInfo.sellRemotes)
        for _, remote in ipairs(sellInfo.sellRemotes) do
            print("    ðŸ“¡ " .. remote)
        end
    end
    
    -- Cari folder item di inventory/backpack
    if player:FindFirstChild("Backpack") then
        logInfo("Backpack Items", #player.Backpack:GetChildren())
    end
    
    -- Cari sistem currency (koin, gold, dll)
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats then
        logSuccess("Leaderstats Ditemukan", "Ada")
        for _, stat in ipairs(leaderstats:GetChildren()) do
            local name = stat.Name:lower()
            if name:find("gold") or name:find("coin") or name:find("money") or 
               name:find("uang") or name:find("points") or name:find("cash") then
                sellInfo.currencyType = stat.Name
                logSuccess("Currency Type", stat.Name .. " = " .. tostring(stat.Value))
            end
        end
    end
    
    return sellInfo
end

-- =============================================
-- 2. DETEKSI ANTI AFK
-- =============================================
local function detectAntiAFKInfo()
    logSection("ANTI AFK DETECTION")
    
    local afkInfo = {
        kickMessages = {},
        afkTimers = {},
        movementNeeded = true,
        jumpNeeded = false,
        mouseNeeded = true,
        chatNeeded = false
    }
    
    -- Cari kemungkinan pesan kick AFK
    local kickPhrases = {
        "afk", "idle", "inactive", "diam", "too long",
        "kick", "disconnect", "timeout", "away"
    }
    
    -- Monitor chat log untuk pesan kick
    local chatService = game:GetService("Chat")
    logInfo("Chat Service", chatService and "Ada" or "Tidak ada")
    
    -- Cek timer di PlayerScripts
    if player:FindFirstChild("PlayerScripts") then
        for _, script in ipairs(player.PlayerScripts:GetChildren()) do
            if script:IsA("LocalScript") then
                local source = script.Source or ""
                for _, phrase in ipairs(kickPhrases) do
                    if source:lower():find(phrase) then
                        table.insert(afkInfo.afkTimers, script.Name)
                        logWarning("Potential AFK Timer", script.Name)
                    end
                end
            end
        end
    end
    
    -- Cek kebijakan server (biasanya di HttpService)
    logInfo("Server Tick Rate", runService:GetPropertyChangedSignal("Stepped") and "Normal" or "Unknown")
    
    -- Deteksi apakah game memonitor gerakan
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            logInfo("Humanoid Detected", "Ada")
            logInfo("WalkSpeed Normal", humanoid.WalkSpeed)
            logInfo("JumpPower Normal", humanoid.JumpPower)
        end
    end
    
    -- Cek sistem anti-AFK umum
    logSuccess("Anti AFK Recommendations", "")
    print("    â€¢ Gerakkan mouse setiap 5-10 menit")
    print("    â€¢ Lompat sesekali")
    print("    â€¢ Jangan diam di satu tempat terlalu lama")
    
    return afkInfo
end

-- =============================================
-- 3. DETEKSI KILL AURA LENGKAP
-- =============================================
local function detectKillAuraInfo()
    logSection("KILL AURA DETECTION")
    
    local killInfo = {
        mobFolders = {},
        mobNames = {},
        damageRemotes = {},
        damageMethods = {},
        attackCooldowns = {},
        mobRespawnTime = 0,
        mobHealth = {},
        mobTags = {}
    }
    
    -- Cari folder tempat mob disimpan
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Folder") then
            local name = obj.Name:lower()
            if name:find("mob") or name:find("enemy") or name:find("monster") or 
               name:find("musuh") or name:find("spawn") or name:find("creature") then
                table.insert(killInfo.mobFolders, obj.Name)
                
                -- Cek isi folder
                local mobCount = 0
                for _, mob in ipairs(obj:GetChildren()) do
                    if mob:IsA("Model") then
                        mobCount = mobCount + 1
                        if mobCount <= 3 then  -- Batasi 3 contoh
                            table.insert(killInfo.mobNames, mob.Name)
                        end
                    end
                end
                logSuccess("Folder " .. obj.Name, mobCount .. " mobs")
            end
        end
    end
    
    -- Cari mob di workspace langsung
    local mobExamples = {}
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and not players:GetPlayerFromCharacter(obj) then
            local mobName = obj.Name
            if #mobExamples < 5 then
                table.insert(mobExamples, mobName)
            end
            
            -- Deteksi health
            local humanoid = obj:FindFirstChild("Humanoid")
            if humanoid then
                killInfo.mobHealth[obj.Name] = {
                    current = humanoid.Health,
                    max = humanoid.MaxHealth
                }
                
                -- Deteksi damage method
                local methods = {}
                if pcall(function() humanoid.Health = humanoid.Health end) then
                    table.insert(methods, "HEALTH_DIRECT")
                end
                if humanoid.TakeDamage then
                    table.insert(methods, "TAKE_DAMAGE")
                end
                killInfo.damageMethods[obj.Name] = methods
            end
            
            -- Deteksi tag/attribute
            for _, attr in ipairs(obj:GetAttributes()) do
                table.insert(killInfo.mobTags, attr)
            end
        end
    end
    
    logSuccess("Contoh Mobs", table.concat(mobExamples, ", "))
    
    -- Cari remote untuk attack
    for _, obj in ipairs(replicatedStorage:GetChildren()) do
        if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
            local name = obj.Name:lower()
            if name:find("attack") or name:find("damage") or name:find("hit") or 
               name:find("swing") or name:find("slash") or name:find("punch") or
               name:find("kill") or name:find("serang") or name:find("combat") then
                table.insert(killInfo.damageRemotes, obj.Name)
            end
        end
    end
    
    if #killInfo.damageRemotes > 0 then
        logSuccess("Damage Remotes", #killInfo.damageRemotes)
        for i, remote in ipairs(killInfo.damageRemotes) do
            print("    " .. i .. ". " .. remote)
        end
    end
    
    -- Deteksi cooldown attack (dari animasi atau script)
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            local animator = humanoid:FindFirstChildOfClass("Animator")
            if animator then
                for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
                    if track.Animation.AnimationId:lower():find("attack") then
                        logInfo("Attack Animation", track.Name)
                        logInfo("Animation Length", track.Length)
                    end
                end
            end
        end
    end
    
    return killInfo
end

-- =============================================
-- 4. DETEKSI FITUR TAMBAHAN
-- =============================================
local function detectAdditionalFeatures()
    logSection("ADDITIONAL FEATURES")
    
    local features = {
        autoCollect = false,
        autoQuest = false,
        autoUpgrade = false,
        teleportPoints = {}
    }
    
    -- Cek auto collect (touch interest)
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Part") or obj:IsA("Model") then
            if obj.Name:lower():find("coin") or obj.Name:lower():find("gold") or 
               obj.Name:lower():find("item") or obj.Name:lower():find("drop") then
                features.autoCollect = true
                logSuccess("Collectible Items", obj.Name)
            end
        end
    end
    
    -- Cek teleport points (portal, door, dll)
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:IsA("Part") or obj:IsA("Model") then
            local name = obj.Name:lower()
            if name:find("portal") or name:find("door") or name:find("gate") or 
               name:find("pintu") or name:find("teleport") or name:find("warp") then
                table.insert(features.teleportPoints, obj.Name)
            end
        end
    end
    
    if #features.teleportPoints > 0 then
        logSuccess("Teleport Points", #features.teleportPoints)
    end
    
    return features
end

-- =============================================
-- 5. GENERATE READY-TO-USE CONFIG
-- =============================================
local function generateConfig()
    logSection("READY-TO-USE CONFIGURATION")
    
    print("\n-- Copy paste ini ke script Anda:\n")
    print("local GAME_CONFIG = {")
    
    -- Auto Sell Config
    print("\n    -- AUTO SELL CONFIG")
    local sellInfo = detectAutoSellInfo()
    print("    autoSell = {")
    print("        enabled = false,")
    print("        merchants = {")
    for i, merchant in ipairs(sellInfo.merchants) do
        print("            \"" .. merchant.name .. "\",")
    end
    print("        },")
    print("        sellRemotes = {")
    for _, remote in ipairs(sellInfo.sellRemotes) do
        print("            \"" .. remote .. "\",")
    end
    print("        },")
    print("        currencyType = \"" .. sellInfo.currencyType .. "\",")
    print("        sellThreshold = 100, -- Jual saat item > 100")
    print("    },")
    
    -- Anti AFK Config
    print("\n    -- ANTI AFK CONFIG")
    print("    antiAFK = {")
    print("        enabled = false,")
    print("        moveMouse = true,    -- Gerakkan mouse")
    print("        jumpEvery = 300,     -- Lompat setiap 5 menit")
    print("        walkEvery = 600,      -- Jalan setiap 10 menit")
    print("        chatMessage = \"\",    -- Pesan chat (opsional)")
    print("    },")
    
    -- Kill Aura Config
    print("\n    -- KILL AURA CONFIG")
    local killInfo = detectKillAuraInfo()
    print("    killAura = {")
    print("        enabled = false,")
    print("        radius = 15,")
    print("        damage = 30,")
    print("        speed = 0.2,")
    print("        mobFolders = {")
    for _, folder in ipairs(killInfo.mobFolders) do
        print("            \"" .. folder .. "\",")
    end
    print("        },")
    print("        damageRemotes = {")
    for _, remote in ipairs(killInfo.damageRemotes) do
        print("            \"" .. remote .. "\",")
    end
    print("        },")
    print("        damageMethods = {")
    for mob, methods in pairs(killInfo.damageMethods) do
        print("            [\"" .. mob .. "\"] = \"" .. table.concat(methods, "|") .. "\",")
        break  -- Hanya contoh pertama
    end
    print("        },")
    print("    },")
    
    -- Additional Features
    local addFeatures = detectAdditionalFeatures()
    print("\n    -- ADDITIONAL FEATURES")
    print("    additional = {")
    print("        autoCollect = " .. tostring(addFeatures.autoCollect) .. ",")
    print("        teleportPoints = {")
    for _, point in ipairs(addFeatures.teleportPoints) do
        print("            \"" .. point .. "\",")
    end
    print("        },")
    print("    }")
    
    print("}")
end

-- =============================================
-- MAIN LOGGER FUNCTION
-- =============================================
local function runGameStructureLogger()
    logSection("GAME STRUCTURE LOGGER - VERSI LENGKAP")
    logInfo("Game ID", game.PlaceId)
    logInfo("Game Name", game.Name)
    logInfo("Timestamp", os.date("%Y-%m-%d %H:%M:%S"))
    
    -- Jalankan semua deteksi
    detectAutoSellInfo()
    detectAntiAFKInfo()
    detectKillAuraInfo()
    detectAdditionalFeatures()
    
    -- Generate config
    generateConfig()
    
    logSection("LOGGING COMPLETE")
    print("\nâœ… Tekan L untuk menjalankan ulang logger")
    print("âœ… Copy config di atas ke script template Anda")
end

-- Run logger
runGameStructureLogger()

-- Hotkey untuk re-run
userInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.L then
        print("\n\n")
        print("ðŸ”„ RERUNNING GAME STRUCTURE LOGGER...")
        runGameStructureLogger()
    end
end)
