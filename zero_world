-- =============================================
-- SCRIPT RPG GRINDER - BERDASARKAN DATA LOGGER
-- Game: Ugc (ID: 4310463616)
-- =============================================

local player = game.Players.LocalPlayer
local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local players = game:GetService("Players")
local virtualInputManager = game:GetService("VirtualInputManager")
local tweenService = game:GetService("TweenService")
local replicatedStorage = game:GetService("ReplicatedStorage")

-- =============================================
-- KONFIGURASI DARI HASIL LOGGER
-- =============================================
local GAME_CONFIG = {
    -- Informasi Dasar
    rootPartName = "HumanoidRootPart",
    humanoidName = "Humanoid",
    damageMethod = "HEALTH_DIRECT",  -- Bisa langsung set health
    
    -- Data Mob
    mobFolder = "NPC",  -- Dari lokasi: workspace/NPC/
    contohMob = "PirateCaptain",
    
    -- Folder Penting
    importantFolders = {
        "TargetDummies",  -- Mungkin tempat latihan
        "Waystones",      -- Mungkin teleport point
        "MobAreas",       -- Area tempat mob spawn
        "World_Bounds",   -- Batas dunia
        "MenuRings"       -- Mungkin GUI/UI
    },
    
    -- Tidak ada remote attack spesifik (pakai damage langsung)
    attackRemotes = {}
}

-- =============================================
-- VARIABEL GLOBAL
-- =============================================
local floatingActive = false
local killAuraActive = false
local autoClickActive = false
local autoCollectActive = false
local teleportActive = false
local espActive = false

local currentTarget = nil
local floatDistance = 5
local searchRadius = 50
local killRadius = 20
local damageAmount = 50
local collectRadius = 20
local killSpeed = 0.2

local character = nil
local humanoidRootPart = nil

-- VARIABEL LAIN
local lastKillTime = 0
local mobList = {}
local waypoints = {}

-- =============================================
-- FUNGSI DASAR
-- =============================================
local function updateCharacter()
    character = player.Character
    if character then
        humanoidRootPart = character:FindFirstChild(GAME_CONFIG.rootPartName)
        if not humanoidRootPart then
            humanoidRootPart = character:WaitForChild(GAME_CONFIG.rootPartName)
        end
        return true
    end
    return false
end

local function waitForCharacter()
    character = player.Character or player.CharacterAdded:Wait()
    humanoidRootPart = character:WaitForChild(GAME_CONFIG.rootPartName)
    return true
end

-- =============================================
-- FUNGSI DETEKSI MOB (BERDASARKAN DATA LOGGER)
-- =============================================

-- Cari folder NPC
local function getNPCFolder()
    -- Coba cari folder NPC
    local npcFolder = workspace:FindFirstChild("NPC")
    if npcFolder then
        return npcFolder
    end
    
    -- Cari di folder penting lainnya
    for _, folderName in ipairs(GAME_CONFIG.importantFolders) do
        local folder = workspace:FindFirstChild(folderName)
        if folder then
            return folder
        end
    end
    
    return workspace
end

-- Deteksi apakah objek adalah mob
local function isMob(obj)
    if not obj:IsA("Model") then return false end
    if not obj:FindFirstChild("Humanoid") then return false end
    if players:GetPlayerFromCharacter(obj) then return false end
    
    -- Cek apakah ini NPC (tidak bisa dibunuh)
    local name = obj.Name:lower()
    local npcIndicators = {"npc", "merchant", "shop", "trader", "guard"}
    for _, indicator in ipairs(npcIndicators) do
        if name:find(indicator) then
            return false  -- Ini NPC, jangan dibunuh
        end
    end
    
    return true
end

-- Mendapatkan semua mob dalam radius
local function getMobsInRange(range)
    if not humanoidRootPart then return {} end
    
    local mobs = {}
    local playerPos = humanoidRootPart.Position
    local npcFolder = getNPCFolder()
    
    -- Fungsi scan rekursif
    local function scanForMobs(container)
        for _, obj in ipairs(container:GetChildren()) do
            if obj:IsA("Model") and isMob(obj) then
                local rootPart = obj:FindFirstChild(GAME_CONFIG.rootPartName) or 
                                 obj:FindFirstChild("Torso") or
                                 obj:FindFirstChildOfClass("BasePart")
                
                if rootPart then
                    local distance = (playerPos - rootPart.Position).Magnitude
                    if distance <= (range or searchRadius) then
                        table.insert(mobs, {
                            model = obj,
                            rootPart = rootPart,
                            humanoid = obj:FindFirstChild("Humanoid")
                        })
                    end
                end
            end
            
            -- Scan folder di dalamnya
            if obj:IsA("Folder") then
                scanForMobs(obj)
            end
        end
    end
    
    scanForMobs(npcFolder)
    return mobs
end

-- Mendapatkan mob terdekat
local function getNearestMob()
    local mobs = getMobsInRange(searchRadius)
    local nearest = nil
    local shortestDist = math.huge
    
    for _, mob in ipairs(mobs) do
        local dist = (humanoidRootPart.Position - mob.rootPart.Position).Magnitude
        if dist < shortestDist then
            shortestDist = dist
            nearest = mob
        end
    end
    
    return nearest
end

-- =============================================
-- FITUR 1: TELEPORT KE MOB
-- =============================================
local function teleportToMob(mob)
    if not mob or not mob.rootPart or not humanoidRootPart then return end
    
    -- Teleport ke belakang mob (posisi strategis)
    local mobPos = mob.rootPart.Position
    local mobDirection = mob.rootPart.CFrame.LookVector
    local targetPos = mobPos - (mobDirection * floatDistance) + Vector3.new(0, 2, 0)
    
    -- Teleport instan
    humanoidRootPart.CFrame = CFrame.lookAt(targetPos, mobPos)
    print("üìå Teleport ke:", mob.model.Name)
end

-- Cari dan teleport ke mob terdekat
local function findAndTeleport()
    local mob = getNearestMob()
    if mob then
        currentTarget = mob
        teleportToMob(currentTarget)
        print("üéØ Target:", mob.model.Name, "HP:", math.floor(mob.humanoid.Health))
    else
        currentTarget = nil
        print("‚ùå Tidak ada mob di sekitar")
    end
end

-- =============================================
-- FITUR 2: KILL AURA (LANGSUNG KURANGI HEALTH)
-- =============================================
local function killAura()
    if not killAuraActive then return end
    
    local currentTime = tick()
    if currentTime - lastKillTime < killSpeed then return end
    
    local mobs = getMobsInRange(killRadius)
    
    for _, mob in ipairs(mobs) do
        if mob and mob.humanoid and mob.humanoid.Health > 0 then
            -- Langsung kurangi health (HEALTH_DIRECT)
            pcall(function()
                local newHealth = mob.humanoid.Health - damageAmount
                if newHealth <= 0 then
                    mob.humanoid.Health = 0
                    print("üíÄ Mob mati:", mob.model.Name)
                else
                    mob.humanoid.Health = newHealth
                    print("‚öîÔ∏è Damage:", mob.model.Name, "HP:", math.floor(newHealth))
                end
            end)
            
            -- Backup method: TakeDamage
            pcall(function()
                if mob.humanoid.TakeDamage then
                    mob.humanoid:TakeDamage(damageAmount)
                end
            end)
        end
    end
    
    if #mobs > 0 then
        lastKillTime = currentTime
    end
end

-- =============================================
-- FITUR 3: TELEPORT KE WAYSTONES
-- =============================================
local function scanWaystones()
    waypoints = {}
    local waystoneFolder = workspace:FindFirstChild("Waystones")
    
    if waystoneFolder then
        for _, obj in ipairs(waystoneFolder:GetChildren()) do
            if obj:IsA("Model") or obj:IsA("Part") then
                local rootPart = obj:FindFirstChild(GAME_CONFIG.rootPartName) or obj
                if rootPart and rootPart:IsA("BasePart") then
                    table.insert(waypoints, {
                        name = obj.Name,
                        position = rootPart.Position,
                        part = rootPart
                    })
                end
            end
        end
        print("üìç Waystones ditemukan:", #waypoints)
    end
end

local function teleportToWaystone(index)
    if #waypoints == 0 then
        scanWaystones()
    end
    
    if #waypoints >= index then
        local wp = waypoints[index]
        humanoidRootPart.CFrame = CFrame.new(wp.position + Vector3.new(0, 3, 0))
        print("üìå Teleport ke Waystone:", wp.name)
    end
end

-- =============================================
-- FITUR 4: AUTO CLICK
-- =============================================
local function autoClick()
    if not autoClickActive then return end
    
    local viewport = workspace.CurrentCamera.ViewportSize
    local center = Vector2.new(viewport.X / 2, viewport.Y / 2)
    
    for i = 1, 5 do
        virtualInputManager:SendMouseButtonEvent(center.X, center.Y, 0, true, game, 0)
        wait(0.01)
        virtualInputManager:SendMouseButtonEvent(center.X, center.Y, 0, false, game, 0)
        wait(0.01)
    end
end

-- =============================================
-- FITUR 5: ESP (LIHAT MOB TEMBUS PANDANG)
-- =============================================
local function updateESP()
    if not espActive then return end
    
    -- Hapus ESP lama
    for _, v in ipairs(workspace:GetDescendants()) do
        if v.Name == "ESP_Box" then
            v:Destroy()
        end
    end
    
    -- Buat ESP baru
    local mobs = getMobsInRange(999)
    for _, mob in ipairs(mobs) do
        if mob.rootPart then
            local box = Instance.new("BoxHandleAdornment")
            box.Name = "ESP_Box"
            box.Size = Vector3.new(4, 6, 4)
            box.Transparency = 0.5
            box.Color3 = Color3.fromRGB(255, 0, 0)
            box.AlwaysOnTop = true
            box.ZIndex = 10
            box.Adornee = mob.rootPart
            box.Parent = mob.model
        end
    end
end

-- =============================================
-- KEYBIND SYSTEM
-- =============================================
userInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if not character or not humanoidRootPart then
        waitForCharacter()
    end
    
    -- TELEPORT KE MOB (Tombol F)
    if input.KeyCode == Enum.KeyCode.F then
        findAndTeleport()
    end
    
    -- KILL AURA (Tombol G)
    if input.KeyCode == Enum.KeyCode.G then
        killAuraActive = not killAuraActive
        print("‚öîÔ∏è KILL AURA:", killAuraActive and "ON" or "OFF")
    end
    
    -- AUTO CLICK (Tombol C)
    if input.KeyCode == Enum.KeyCode.C then
        autoClickActive = not autoClickActive
        print("üñ±Ô∏è AUTO CLICK:", autoClickActive and "ON" or "OFF")
    end
    
    -- ESP (Tombol E)
    if input.KeyCode == Enum.KeyCode.E then
        espActive = not espActive
        print("üëÅÔ∏è ESP:", espActive and "ON" or "OFF")
        if not espActive then
            for _, v in ipairs(workspace:GetDescendants()) do
                if v.Name == "ESP_Box" then
                    v:Destroy()
                end
            end
        end
    end
    
    -- SCAN WAYSTONES (Tombol W)
    if input.KeyCode == Enum.KeyCode.W then
        scanWaystones()
    end
    
    -- TELEPORT KE WAYSTONE 1 (Tombol 1)
    if input.KeyCode == Enum.KeyCode.One then
        teleportToWaystone(1)
    end
    
    -- TELEPORT KE WAYSTONE 2 (Tombol 2)
    if input.KeyCode == Enum.KeyCode.Two then
        teleportToWaystone(2)
    end
    
    -- STATUS (Tombol P)
    if input.KeyCode == Enum.KeyCode.P then
        local mobCount = #getMobsInRange(999)
        print("=================================")
        print("üìä STATUS:")
        print("Mob di sekitar:", mobCount)
        print("Kill Aura:", killAuraActive and "ON" or "OFF")
        print("ESP:", espActive and "ON" or "OFF")
        print("Auto Click:", autoClickActive and "ON" or "OFF")
        print("=================================")
    end
end)

-- =============================================
-- LOOP UTAMA
-- =============================================
updateCharacter()
scanWaystones()  -- Scan waystones di awal

runService.Heartbeat:Connect(function()
    pcall(function()
        if not character or not humanoidRootPart then
            if player.Character then
                updateCharacter()
            end
            return
        end
        
        -- Kill Aura
        if killAuraActive then
            killAura()
        end
        
        -- Auto Click
        if autoClickActive then
            autoClick()
        end
        
        -- ESP
        if espActive then
            updateESP()
        end
        
        wait(0.1)
    end)
end)

-- =============================================
-- DETEKSI RESPAWN
-- =============================================
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoidRootPart = character:WaitForChild(GAME_CONFIG.rootPartName)
    print("üîÑ Karakter respawn!")
end)

-- =============================================
-- GUI SEDERHANA
-- =============================================
local function createGUI()
    -- Hapus GUI lama
    pcall(function()
        for _, gui in ipairs(player.PlayerGui:GetChildren()) do
            if gui.Name == "RPG_Grinder" then
                gui:Destroy()
            end
        end
    end)
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "RPG_Grinder"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player.PlayerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 280, 0, 350)
    frame.Position = UDim2.new(0, 20, 0.5, -175)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true
    frame.Parent = screenGui
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 35)
    title.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    title.Text = "‚ö° UGC GRINDER"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.Parent = frame
    
    local yPos = 45
    
    local function createButton(text, color, key)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, -20, 0, 30)
        btn.Position = UDim2.new(0, 10, 0, yPos)
        btn.BackgroundColor3 = color
        btn.Text = text .. " [" .. key .. "]"
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 14
        btn.Parent = frame
        return btn
    end
    
    -- Tombol Teleport ke Mob
    local btnF = createButton("Teleport ke Mob", Color3.fromRGB(50, 100, 200), "F")
    btnF.MouseButton1Click:Connect(findAndTeleport)
    yPos = yPos + 35
    
    -- Tombol Kill Aura
    local btnG = createButton("Kill Aura", Color3.fromRGB(200, 80, 80), "G")
    btnG.MouseButton1Click:Connect(function()
        killAuraActive = not killAuraActive
        btnG.BackgroundColor3 = killAuraActive and Color3.fromRGB(200, 80, 80) or Color3.fromRGB(60, 60, 70)
        btnG.Text = (killAuraActive and "üî¥ " or "üü¢ ") .. "Kill Aura [G]"
    end)
    yPos = yPos + 35
    
    -- Tombol Auto Click
    local btnC = createButton("Auto Click", Color3.fromRGB(60, 60, 70), "C")
    btnC.MouseButton1Click:Connect(function()
        autoClickActive = not autoClickActive
        btnC.BackgroundColor3 = autoClickActive and Color3.fromRGB(200, 80, 80) or Color3.fromRGB(60, 60, 70)
        btnC.Text = (autoClickActive and "üî¥ " or "üü¢ ") .. "Auto Click [C]"
    end)
    yPos = yPos + 35
    
    -- Tombol ESP
    local btnE = createButton("ESP", Color3.fromRGB(60, 60, 70), "E")
    btnE.MouseButton1Click:Connect(function()
        espActive = not espActive
        btnE.BackgroundColor3 = espActive and Color3.fromRGB(200, 80, 80) or Color3.fromRGB(60, 60, 70)
        btnE.Text = (espActive and "üî¥ " or "üü¢ ") .. "ESP [E]"
    end)
    yPos = yPos + 35
    
    -- Tombol Scan Waystones
    local btnW = createButton("Scan Waystones", Color3.fromRGB(100, 150, 100), "W")
    btnW.MouseButton1Click:Connect(scanWaystones)
    yPos = yPos + 35
    
    -- Tombol Status
    local btnP = createButton("Status", Color3.fromRGB(150, 100, 150), "P")
    btnP.MouseButton1Click:Connect(function()
        local mobCount = #getMobsInRange(999)
        print("üìä Mob di sekitar:", mobCount)
    end)
end

-- Buat GUI
createGUI()

-- =============================================
-- INFO AWAL
-- =============================================
print("=================================")
print("‚ö° UGC GRINDER - READY")
print("=================================")
print("üìã DATA DARI LOGGER:")
print("Game ID: 4310463616")
print("Game Name: Ugc")
print("Mob Contoh: PirateCaptain")
print("Folder: NPC, Waystones, MobAreas")
print("=================================")
print("üéØ KEYBINDS:")
print("F = Teleport ke Mob")
print("G = Kill Aura (ON/OFF)")
print("C = Auto Click (ON/OFF)")
print("E = ESP (ON/OFF)")
print("W = Scan Waystones")
print("1/2 = Teleport ke Waystone 1/2")
print("P = Status")
print("=================================")
